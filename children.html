<!DOCTYPE html>
<html>
<head>
    <meta charSet="utf-8"/>
    <title>brookjs - children</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.0.0/normalize.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/brookjs/css/docs.css">
<link rel="stylesheet" href="/brookjs/css/prism-solarizedlight.css" type="text/css"></head>
<body>
<div class="content">
    <div class="menu">
        <header class="logo">
            <code>brookjs</code>
        </header>
        <nav class="menu-nav">
                <ul class="nav">
                    <span>Introduction</span>
                    <ul class="nav">
                            <li>
                                <a href="/brookjs/index.html">Meet <code>brookjs</code></a>
                            </li>
                            <li>
                                <a href="/brookjs/changelog.html">Changelog</a>
                            </li>
                    </ul>
                </ul>
                <ul class="nav">
                    <span>Writing a <code>brookjs</code> Component</span>
                    <ul class="nav">
                            <li>
                                <a href="/brookjs/what-is-a-component.html">What is a Component?</a>
                            </li>
                            <li>
                                <a href="/brookjs/defining-a-component.html">Defining a Component</a>
                            </li>
                            <li>
                                <a href="/brookjs/writing-a-components-html.html">Writing a Component's HTML</a>
                            </li>
                            <li>
                                <a href="/brookjs/adding-events-to-a-component.html">Adding <code>events</code> to a Component</a>
                            </li>
                            <li>
                                <a href="/brookjs/using-a-template-to-render-a-component.html">Using a Template to <code>render</code> a Component</a>
                            </li>
                            <li>
                                <a href="/brookjs/managing-children-components-in-a-component.html">Managing <code>children</code> Components</a>
                            </li>
                    </ul>
                </ul>
                <ul class="nav">
                    <span>Building a <code>brookjs</code> Application</span>
                    <ul class="nav">
                            <li>
                                <a href="/brookjs/connecting-a-redux-store-to-the-view.html">Connecting a Redux Store to the View</a>
                            </li>
                            <li>
                                <a href="/brookjs/implementing-side-effects-with-custom-delta.html">Implementing Side Effects with Custom Delta</a>
                            </li>
                            <li>
                                <a href="/brookjs/building-the-reducer-with-combineActionReducers.html">Building the Reducer with <code>combineActionReducers</code></a>
                            </li>
                            <li>
                                <a href="/brookjs/bootstrapping-the-application.html">Bootstrapping the Application</a>
                            </li>
                    </ul>
                </ul>
                <ul class="nav">
                    <span>Advanced Component Techniques</span>
                    <ul class="nav">
                            <li>
                                <a href="/brookjs/custom-components-with-blackboxing-and-onmount.html">Custom Components with Blackboxing and <code>onMount</code></a>
                            </li>
                            <li>
                                <a href="/brookjs/animating-a-component.html">Animating a Component</a>
                            </li>
                    </ul>
                </ul>
                <ul class="nav">
                    <span>API</span>
                    <ul class="nav">
                            <li>
                                <a href="/brookjs/component.html">component</a>
                            </li>
                            <li>
                                <a href="/brookjs/observeDelta.html">observeDelta</a>
                            </li>
                            <li>
                                <a href="/brookjs/events.html">events</a>
                            </li>
                            <li>
                                <a href="/brookjs/render.html">render</a>
                            </li>
                            <li>
                                <a href="/brookjs/children.html">children</a>
                            </li>
                            <li>
                                <a href="/brookjs/combineActionReducers.html">combineActionReducers</a>
                            </li>
                            <li>
                                <a href="/brookjs/action.html">action</a>
                            </li>
                            <li>
                                <a href="/brookjs/helpers.html">helpers</a>
                            </li>
                    </ul>
                </ul>
        </nav>
    </div>

    <div class="page">
        <h1><code>children</code></h1>
        <main class="page-content">
            <p><code>children</code> exports a function for plugging child components into a single, combined stream. It keeps the stream updated when components are added or removed using a <code>MutationObserver</code>, so if support for old environments is required, use a polyfill.</p>
<h1 id="How-to-Use"><a href="#How-to-Use" class="headerlink" title="How to Use"></a>How to Use</h1><h2 id="Preparing-the-DOM"><a href="#Preparing-the-DOM" class="headerlink" title="Preparing the DOM"></a>Preparing the DOM</h2><p>When setting up the HTML for a component, the top-level element should have a <code>data-brk-container</code> with a unique name.</p>
<pre class=" language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">data-brk-container</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>kid<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>{{text}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
</code></pre>
<p>A helper is provided to make this easy to integrate with handlebars:</p>
<pre class=" language-handlebars"><code class="language-handlebars"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">{{container</span> <span class="token attr-name">"kid"}}</span><span class="token punctuation">></span></span><span class="token handlebars"><span class="token delimiter punctuation">{{</span><span class="token variable">text</span><span class="token delimiter punctuation">}}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
</code></pre>
<p>This needs to be registered with the Handlebars runtime:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> containerAttribute <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'brookjs'</span>
<span class="token keyword">import</span> Handlebars <span class="token keyword">from</span> <span class="token string">'handlebars/runtime'</span><span class="token punctuation">;</span>

Handlebars<span class="token punctuation">.</span><span class="token function">registerHelper</span><span class="token punctuation">(</span><span class="token string">'container'</span><span class="token punctuation">,</span> key <span class="token operator">=</span><span class="token operator">></span>
  <span class="token keyword">new</span> <span class="token class-name">Handlebars<span class="token punctuation">.</span>SafeString</span><span class="token punctuation">(</span><span class="token function">containerAttribute</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>The compiled templates will now provide the required container attribute through the helper.</p>
<h2 id="Configuring-the-Stream"><a href="#Configuring-the-Stream" class="headerlink" title="Configuring the Stream"></a>Configuring the Stream</h2><p>The <code>children</code> stream accepts a configuration object. The objectâ€™s keys should match the container attribute for the given component. The value can be either a component factory function:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> children <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'brookjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> kid <span class="token keyword">from</span> <span class="token string">'./kid'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">{</span> kid <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>or a configuration object for that component, which defines the behavior of the child in relation to the parent:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> children<span class="token punctuation">,</span> mapActionTo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'brookjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> kid <span class="token keyword">from</span> <span class="token string">'./kid'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    kid<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// only required value.</span>
        <span class="token comment" spellcheck="true">// factory function for child taking el &amp; props$</span>
        factory<span class="token punctuation">:</span> kid<span class="token punctuation">,</span>
        <span class="token comment" spellcheck="true">// passed parents' `props$` stream &amp; child key.</span>
        <span class="token comment" spellcheck="true">// return value is passed to child onMount.</span>
        <span class="token comment" spellcheck="true">// see below for key documentation.</span>
        modifyChildProps<span class="token punctuation">:</span> <span class="token punctuation">(</span>props$<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> props$<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>props <span class="token operator">=</span><span class="token operator">></span> props<span class="token punctuation">.</span>children<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment" spellcheck="true">// passed each child instance to modify child stream</span>
        <span class="token comment" spellcheck="true">// return value is plugged into combined string (hence `preplug`)</span>
        preplug<span class="token punctuation">:</span> <span class="token punctuation">(</span>kid$<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> kid$<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token function">mapActionTo</span><span class="token punctuation">(</span>CHILD_ACTION<span class="token punctuation">,</span> PARENT_ACTION<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>action <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
              <span class="token operator">...</span>action<span class="token punctuation">,</span>
              meta<span class="token punctuation">:</span> <span class="token punctuation">{</span> key <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="Handling-Multiple-Child-Instances"><a href="#Handling-Multiple-Child-Instances" class="headerlink" title="Handling Multiple Child Instances"></a>Handling Multiple Child Instances</h2><p>If a single component will have multiple instances of a child component as a direct child, those instances must be differentiated. The <code>data-brk-key</code> attribute is used to distinguish them in the DOM, and the value of that attribute is passed to <code>modifyChildProps</code> along with the <code>props$</code> stream. Hereâ€™s how itâ€™s intended to be used.</p>
<p>First, an iterated child must have a <code>data-brk-key</code> attribute:</p>
<pre class=" language-handlebars"><code class="language-handlebars"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">data-brk-container</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>child<span class="token punctuation">"</span></span> <span class="token attr-name">data-brk-key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{{id}}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token handlebars"><span class="token delimiter punctuation">{{</span><span class="token variable">label</span><span class="token delimiter punctuation">}}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
</code></pre>
<p>A helper is also provided for the <code>key</code> attribute:</p>
<pre class=" language-handlebars"><code class="language-handlebars"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">{{container</span> <span class="token attr-name">"child"}}</span> <span class="token attr-name">{{key</span> <span class="token attr-name">id}}</span><span class="token punctuation">></span></span><span class="token handlebars"><span class="token delimiter punctuation">{{</span><span class="token variable">label</span><span class="token delimiter punctuation">}}</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
</code></pre>
<p>This also needs to be registered with the Handlebars runtime:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> keyAttribute <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'brookjs'</span>
<span class="token keyword">import</span> Handlebars <span class="token keyword">from</span> <span class="token string">'handlebars/runtime'</span><span class="token punctuation">;</span>

Handlebars<span class="token punctuation">.</span><span class="token function">registerHelper</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">,</span> id <span class="token operator">=</span><span class="token operator">></span>
  <span class="token keyword">new</span> <span class="token class-name">Handlebars<span class="token punctuation">.</span>SafeString</span><span class="token punctuation">(</span><span class="token function">keyAttribute</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>The parent is then responsible for iterating over the props and rendering the children.</p>
<pre class=" language-handlebars"><code class="language-handlebars"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">data-brk-container</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token handlebars"><span class="token delimiter punctuation">{{</span><span class="token block keyword">#each</span> <span class="token variable">kids</span><span class="token delimiter punctuation">}}</span></span>
        <span class="token handlebars"><span class="token delimiter punctuation">{{</span><span class="token punctuation">></span> <span class="token variable">kid</span> <span class="token variable">this</span><span class="token delimiter punctuation">}}</span></span>
    <span class="token handlebars"><span class="token delimiter punctuation">{{</span><span class="token block keyword">/each</span><span class="token delimiter punctuation">}}</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
</code></pre>
<p>For each child, when itâ€™s mounted or added to the DOM, <code>modifyChildProps</code> is called with the parentâ€™s <code>props$</code> stream and the value of the childâ€™s key attribute. The returned stream should be of the childâ€™s props.</p>
<p>The child instance is then passed to <code>preplug</code>, allowing the stream to be modified before itâ€™s plugged into the parent stream. The returned stream should be an <code>Observable&lt;Action&gt;</code>.</p>

        </main>
    </div>
</div>

<footer class="brk-footer">
    <a class="footer" href="https://github.com/valtech-nyc/brookjs">
        Project on github
    </a>

    <div class="switch-page">
    </div>
</footer>
</body>
</html>
