<!DOCTYPE html>
<html>
<head>
    <meta charSet="utf-8"/>
    <title>brookjs - Animating a Component</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.0.0/normalize.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/brookjs/css/docs.css">
<link rel="stylesheet" href="/brookjs/css/prism-solarizedlight.css" type="text/css"></head>
<body>
<div class="content">
    <div class="menu">
        <header class="logo">
            <code>brookjs</code>
        </header>
        <nav class="menu-nav">
                <ul class="nav">
                    <span>Introduction</span>
                    <ul class="nav">
                            <li>
                                <a href="/brookjs/index.html">Meet <code>brookjs</code></a>
                            </li>
                            <li>
                                <a href="/brookjs/changelog.html">Changelog</a>
                            </li>
                    </ul>
                </ul>
                <ul class="nav">
                    <span>Writing a <code>brookjs</code> Component</span>
                    <ul class="nav">
                            <li>
                                <a href="/brookjs/what-is-a-component.html">What is a Component?</a>
                            </li>
                            <li>
                                <a href="/brookjs/defining-a-component.html">Defining a Component</a>
                            </li>
                            <li>
                                <a href="/brookjs/writing-a-components-html.html">Writing a Component's HTML</a>
                            </li>
                            <li>
                                <a href="/brookjs/adding-events-to-a-component.html">Adding <code>events</code> to a Component</a>
                            </li>
                            <li>
                                <a href="/brookjs/using-a-template-to-render-a-component.html">Using a Template to <code>render</code> a Component</a>
                            </li>
                            <li>
                                <a href="/brookjs/managing-children-components-in-a-component.html">Managing <code>children</code> Components</a>
                            </li>
                    </ul>
                </ul>
                <ul class="nav">
                    <span>Building a <code>brookjs</code> Application</span>
                    <ul class="nav">
                            <li>
                                <a href="/brookjs/connecting-a-redux-store-to-the-view.html">Connecting a Redux Store to the View</a>
                            </li>
                            <li>
                                <a href="/brookjs/implementing-side-effects-with-custom-delta.html">Implementing Side Effects with Custom Delta</a>
                            </li>
                            <li>
                                <a href="/brookjs/building-the-reducer-with-combineActionReducers.html">Building the Reducer with <code>combineActionReducers</code></a>
                            </li>
                            <li>
                                <a href="/brookjs/bootstrapping-the-application.html">Bootstrapping the Application</a>
                            </li>
                    </ul>
                </ul>
                <ul class="nav">
                    <span>Advanced Component Techniques</span>
                    <ul class="nav">
                            <li>
                                <a href="/brookjs/custom-components-with-blackboxing-and-onmount.html">Custom Components with Blackboxing and <code>onMount</code></a>
                            </li>
                            <li>
                                <a href="/brookjs/animating-a-component.html">Animating a Component</a>
                            </li>
                    </ul>
                </ul>
                <ul class="nav">
                    <span>API</span>
                    <ul class="nav">
                            <li>
                                <a href="/brookjs/component.html">component</a>
                            </li>
                            <li>
                                <a href="/brookjs/observeDelta.html">observeDelta</a>
                            </li>
                            <li>
                                <a href="/brookjs/events.html">events</a>
                            </li>
                            <li>
                                <a href="/brookjs/render.html">render</a>
                            </li>
                            <li>
                                <a href="/brookjs/children.html">children</a>
                            </li>
                            <li>
                                <a href="/brookjs/combineActionReducers.html">combineActionReducers</a>
                            </li>
                            <li>
                                <a href="/brookjs/action.html">action</a>
                            </li>
                            <li>
                                <a href="/brookjs/helpers.html">helpers</a>
                            </li>
                    </ul>
                </ul>
        </nav>
    </div>

    <div class="page">
        <h1>Animating a Component</h1>
        <main class="page-content">
            <p>The animation API is the most complex aspect of <code>brookjs</code> but provides a lot of control and power over the fine details of how it handles its render logic. The second parameter passed to <code>render</code> is an animation callback. This callback is passed a stream of <code>effect$$</code>, which emits “effect” observables which represent the render side effect to take place. For example, a stream could emit an effect that represents a DOM node being inserted or removed from the DOM, or an attribute on a node changing. When observed, the side effect is run.</p>
<p>This <code>$meta</code> information can be used to control when particular effects are run, how long they’re run, and what else happens before and after they run, allowing you to design and implement cancelable animations. This could be done as follows:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> component<span class="token punctuation">,</span> render<span class="token punctuation">,</span> Kefir <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'brookjs'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> hideElement<span class="token punctuation">,</span> fadeInElement <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./effects'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    render<span class="token punctuation">:</span> <span class="token function">render</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span> effect$$ <span class="token operator">=</span><span class="token operator">></span> effect$$<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>effect$ <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>effect$<span class="token punctuation">.</span>$meta<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'INSERT_NODE'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span> incoming <span class="token punctuation">}</span> <span class="token operator">=</span>  effect<span class="token punctuation">.</span>$meta<span class="token punctuation">;</span>

            <span class="token keyword">return</span> Kefir<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                <span class="token function">hideElement</span><span class="token punctuation">(</span>incoming<span class="token punctuation">)</span><span class="token punctuation">,</span>
                effect$<span class="token punctuation">,</span>
                <span class="token function">fadeInElement</span><span class="token punctuation">(</span>incoming<span class="token punctuation">)</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">takeUntilBy</span><span class="token punctuation">(</span>
                    effect$$<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>effect$ <span class="token operator">=</span><span class="token operator">></span> effect$<span class="token punctuation">.</span>$meta<span class="token punctuation">.</span>outgoing <span class="token operator">===</span> incoming<span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>Assuming <code>hideElement</code> &amp; <code>fadeInElement</code> return observables that perform the expected side effect, this will fade in the incoming element, cancelling the animation of the incoming element is removed from the DOM.</p>
<p>Note also that the <code>effect$$</code> is <code>mapped</code> over. This will be your primary method for interacting with <code>effect$$</code>. <strong>Do not</strong> displace effects in time, e.g. <code>effect$$.delay</code>. Schedule effects for the future by replacing them with new effects that run later instead. Use <code>Kefir.later</code> and <code>flatMap</code> to achieve this. This is because the rendering engine needs to gather the effects before running them, and if they’re not gathered at the same time, effects may not be run at the time expected.</p>

        </main>
    </div>
</div>

<footer class="brk-footer">
    <a class="footer" href="https://github.com/valtech-nyc/brookjs">
        Project on github
    </a>

    <div class="switch-page">
    </div>
</footer>
</body>
</html>
