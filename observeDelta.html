<!DOCTYPE html>
<html>
<head>
    <meta charSet="utf-8"/>
    <title>brookjs - observeDelta</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.0.0/normalize.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300,700" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/brookjs/css/docs.css">
<link rel="stylesheet" href="/brookjs/css/prism-solarizedlight.css" type="text/css"></head>
<body>
<div class="content">
    <div class="menu">
        <header class="logo">
            <code>brookjs</code>
        </header>
        <nav class="menu-nav">
                <ul class="nav">
                    <span>Introduction</span>
                    <ul class="nav">
                            <li>
                                <a href="/brookjs/index.html">Meet <code>brookjs</code></a>
                            </li>
                            <li>
                                <a href="/brookjs/changelog.html">Changelog</a>
                            </li>
                    </ul>
                </ul>
                <ul class="nav">
                    <span>Writing a <code>brookjs</code> Component</span>
                    <ul class="nav">
                            <li>
                                <a href="/brookjs/what-is-a-component.html">What is a Component?</a>
                            </li>
                            <li>
                                <a href="/brookjs/defining-a-component.html">Defining a Component</a>
                            </li>
                            <li>
                                <a href="/brookjs/writing-a-components-html.html">Writing a Component's HTML</a>
                            </li>
                            <li>
                                <a href="/brookjs/adding-events-to-a-component.html">Adding <code>events</code> to a Component</a>
                            </li>
                            <li>
                                <a href="/brookjs/using-a-template-to-render-a-component.html">Using a Template to <code>render</code> a Component</a>
                            </li>
                            <li>
                                <a href="/brookjs/managing-children-components-in-a-component.html">Managing <code>children</code> Components</a>
                            </li>
                    </ul>
                </ul>
                <ul class="nav">
                    <span>Building a <code>brookjs</code> Application</span>
                    <ul class="nav">
                            <li>
                                <a href="/brookjs/connecting-a-redux-store-to-the-view.html">Connecting a Redux Store to the View</a>
                            </li>
                            <li>
                                <a href="/brookjs/implementing-side-effects-with-custom-delta.html">Implementing Side Effects with Custom Delta</a>
                            </li>
                            <li>
                                <a href="/brookjs/building-the-reducer-with-combineActionReducers.html">Building the Reducer with <code>combineActionReducers</code></a>
                            </li>
                            <li>
                                <a href="/brookjs/bootstrapping-the-application.html">Bootstrapping the Application</a>
                            </li>
                    </ul>
                </ul>
                <ul class="nav">
                    <span>Advanced Component Techniques</span>
                    <ul class="nav">
                            <li>
                                <a href="/brookjs/custom-components-with-blackboxing-and-onmount.html">Custom Components with Blackboxing and <code>onMount</code></a>
                            </li>
                            <li>
                                <a href="/brookjs/animating-a-component.html">Animating a Component</a>
                            </li>
                    </ul>
                </ul>
                <ul class="nav">
                    <span>API</span>
                    <ul class="nav">
                            <li>
                                <a href="/brookjs/component.html">component</a>
                            </li>
                            <li>
                                <a href="/brookjs/observeDelta.html">observeDelta</a>
                            </li>
                            <li>
                                <a href="/brookjs/events.html">events</a>
                            </li>
                            <li>
                                <a href="/brookjs/render.html">render</a>
                            </li>
                            <li>
                                <a href="/brookjs/children.html">children</a>
                            </li>
                            <li>
                                <a href="/brookjs/combineActionReducers.html">combineActionReducers</a>
                            </li>
                            <li>
                                <a href="/brookjs/action.html">action</a>
                            </li>
                            <li>
                                <a href="/brookjs/helpers.html">helpers</a>
                            </li>
                    </ul>
                </ul>
        </nav>
    </div>

    <div class="page">
        <h1><code>observeDelta</code></h1>
        <main class="page-content">
            <p><code>observeDelta</code> is a Redux middleware for binding a set of delta source streams to a Redux store.</p>
<p>When the middleware gets applied, each source function will be called with two parameters: <code>actions$</code> and <code>state$</code>. These are <code>Kefir.Observable</code>s, with the <code>actions$</code> stream emitting every action dispatched through the middleware, and the <code>state$</code> emitting each new state after each action. Each source function should return a Kefir stream, which are combined into a <code>delta$</code> stream that emits actions into the Redux store.</p>
<p>Specifically, <code>state$</code> is a <code>Kefir.Property</code>, which means it retains its current value when it gets subscribed to. Additionally, note that the <code>state$</code> will have its value emitted before the <code>action$</code>, ensuring that any combination of the stream will have the latest state when the action is emitted.</p>
<h1 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h1><p>An example <code>source$</code> stream:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> Kefir <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'brookjs'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">exampleSourceStream</span><span class="token punctuation">(</span>actions$<span class="token punctuation">,</span> state$<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> save$ <span class="token operator">=</span> actions$<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>action <span class="token operator">=</span><span class="token operator">></span> action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'SAVE_THING'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> save$<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>action <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'some/url'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            type<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
            body<span class="token punctuation">:</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>action<span class="token punctuation">.</span>payload<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> Kefir<span class="token punctuation">.</span><span class="token function">fromPromise</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>response <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
                type<span class="token punctuation">:</span> <span class="token string">'THING_SAVED'</span><span class="token punctuation">,</span>
                payload<span class="token punctuation">:</span> response
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Applying the middleware with the example:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> applyMiddleware<span class="token punctuation">,</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'redux'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> observeDelta <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'brookjs'</span>
<span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">'./reducer'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> exampleSourceStream <span class="token keyword">from</span> <span class="token string">'./example'</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token function">observeDelta</span><span class="token punctuation">(</span>exampleSourceStream<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">'SAVE_THING'</span><span class="token punctuation">,</span> payload<span class="token punctuation">:</span> <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'The Thing to save'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>If you need to get the state on every action, use <code>sampledBy</code>:</p>
<pre class=" language-js"><code class="language-js"><span class="token keyword">import</span> <span class="token punctuation">{</span> Kefir <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'brookjs'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">exampleSourceStream</span><span class="token punctuation">(</span>actions$<span class="token punctuation">,</span> state$<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> save$ <span class="token operator">=</span> actions$<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>action <span class="token operator">=</span><span class="token operator">></span> action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'SAVE_USER_BUTTON_CLICK'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> state$<span class="token punctuation">.</span><span class="token function">sampledBy</span><span class="token punctuation">(</span>save$<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>state <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            type<span class="token punctuation">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
            body<span class="token punctuation">:</span> JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>user<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> Kefir<span class="token punctuation">.</span><span class="token function">fromPromise</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>response <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
                type<span class="token punctuation">:</span> <span class="token string">'USER_SAVED'</span><span class="token punctuation">,</span>
                payload<span class="token punctuation">:</span> response
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>

        </main>
    </div>
</div>

<footer class="brk-footer">
    <a class="footer" href="https://github.com/valtech-nyc/brookjs">
        Project on github
    </a>

    <div class="switch-page">
    </div>
</footer>
</body>
</html>
